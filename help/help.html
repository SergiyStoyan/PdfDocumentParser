<html>

<style>
h1 {color:#347; text-align: center;}
h2 {color:#702; text-indent: 20px; margin-top:50}
h3 {color:#069; margin-top:40}
p {
    margin: 5;
    margin-top:5
    padding1: 0;
}
</style>




<head>
</head>
<body>
<h1>Pdf Document Parser</h1>
<h2>Overview</h2>
<p>PdfDocumentParser is intended to extract text/images from PDF documents that conform to a predefined graphic layout - such as invoices and the like. The main approach of parsing is based on finding certain text or image fragments in page and then extracting text from rectangle whose coordinates relate to them.
<p>Within this scope PdfDocumentParser provides the following options:
<ul>
<li>PDF entities processing (the main way to operate with text in PdfDocumentParser);</li>
<li>OCR processing;</li>
<li>Image processing;</li>
</ul>
<p>PdfDocumentParser can process documents of different structures at the same time. 
<p>Every document type needs a template that contains information what text/image must be parsed and how. PdfDocumentParser provides GUI template editor where you can open a PDF file and create a parsing template for it.

<h2>Assumptions</h2>
<ul>
<li>A PDF file can contain more than one document.</li>
<li>A PDF file can contain only documents of the same type.</li>
<li>A document can consist of more than one page.</li>
</ul>
<p>These assumptions is not something deep rooted in the code so if you have different requirements, the code can be easily modified.


<h2>Template</h2>
<p>When you want to parse a new type document, first create an empty template and open it. Select a sample PDF file to be parsed and when it is displayed in the editor you will go through the following steps:
<ul>
<li> optionally create <a href="#floating_anchor">floating anchors</a>;</li>
<li> create <a href="#mark">document recognition marks</a>;</li>
<li> create <a href="#field">fields</a>;</li>
<li> select each created element and see in the status box if it works as expected;</li>
<li> optionally define <a href="#file_filter">file filter</a>;</li>
<li> save the template;</li>
</ul>


<h3><a name="floating_anchor">Floating Anchor</a></h3>
<p>Floating anchor is a fragment of either text or image that PdfDocumentParser will look for in every page of a document. Then if found, the anchor is used to locate in the page Marks or/and Fields that are linked to this anchor. While the idea of floating anchors is detecting points in page that can be used as absolute coordinate zero, it serves for multiple tasks:
<ul>
<li> finding marks/fields whose position in the page may vary e.g. finding value of 'total amount' in the bottom of invoice table;</li> 
<li> recognizing marks/fields which may be met only in one page of a multipage document;</li>
<li> detecting page zero position in scanned documents that usually have their margins vary;</li>
</ul>
<p>To create a Floating anchor, select a new row in the floating anchors table and chose its type which can be one of the following:
<ul>
<li>PDF text, which is a text presented as PDF char boxes;</li>
<li>OCR text, which is a text recognized by OCR engine within selected area;</li>
<li>Image data, which is a hash of the image bounded by the selection box;</li>
</ul>
<p>Then select with mouse a rectangle in the document page. The text or image within the selection box will be a fragment that PdfDocumentParser will look for.
<p>If you keep Ctrl pressed while selecting, you can select more than 1 element for the same anchor. To stop selecting, you have to release Ctrl before releasing mouse button.
<p>Upon creating a floating anchor you can create either document recognition marks or fields and link them to the anchor. Linking means that mark's or field's coordinates become relative to the floating anchor they are linked to. That's PdfDocumentParser first will look for the floating anchor and if it is found, it will then locate on the page the linked marks/fields depending on the location of their anchor.

<h3><a name="mark">Document Recognition Mark</a></h3>
<p>Document recognition mark is a fragment of either text or image that PdfDocumentParser will look in a document. One or more such marks is used by PdfDocumentParser to detect which template corresponds to the processed document. For this reason every template should have at least one document recognition mark defined. It is obviously that such marks must be unique enough to identify the document they belong to with a high confidence. It works the following way: PdfDocumentParser finds a mark in page and compares the found content with the stored mark's content. 
<p>If all marks of a template are found in one page then this template is chosen for further processing of all the pages of the whole file and no more template recognition is done. However, presence of marks is checked for every page to detect beginning of a new document.
<p>To create a document recognition mark, select a new row in the marks. Then the new mark can be defined in 3 ways: 
<ul>
<li> link the mark to a floating anchor by choosing its ID and it finish on that leaving the mark itself empty. In this case, PdfDocumentParser will look for the anchor and when it is found, the document recognition mark is considered found as well;
<li> select with mouse a rectangle in the page whose content is unique for this document type. E.g. for invoice it will be a company name or logo printed in the top of page. If you are sure that this mark always is located in the same position within page then no need to link the mark to a floating anchor. It this case, PdfDocumentParser will locate mark's rectangle in page and compare its content with mark's content: when they are the same then the mark is considered found;
<li> otherwise, usually when parsing scanned documents, you have to link the mark to an anchor. It this case, PdfDocumentParser will find the anchor, then locate mark's rectangle relatively to the anchor and then compare its content to the stored mark's content.
</ul>

<h3><a name="field">Field</a></h3>
<p>Field defines certain text that you want extract from document. Like with document recognition marks it can either be linked to an anchor or retain absolute position in page. 
<p>To create a field, select a new row in the fields table and select the area in page were text for this field must be extracted. 
<p>For conventional PDF documents you should never use OCR option but for scanned documents it is the only way to get text in digital form that can be recorded in a file or database, indexed, searched and so on.
<p>Every field is looked for in every page. This means that if a field has no anchor, it will be extracted from every page and only the value from the last page of a document will be recorded which may be wrong. To detect the correct page a floating anchor is used. E.g. if you want to extract invoice number then create a floating anchor pointing to something like "Invoice #:" and then link the field to it. Now PdfDocumentParser will extract this field only when "Invoice #:" is found. 
<p>But when you know that every document consists only of a single page and the field is always located in the same position on page then there is no need to link it to a floating anchor.

<h3><a name="file_filter">File Filter</a></h3>
<p>When file names can suggest which template must be applied then yon can specify file filter in this template. It is a <a href='https://en.wikipedia.org/wiki/Regular_expression'>regex expression</a> applied to document path. Such filter will reduce processing time hugely and should be used whenever possible.

<h2>Text/image operation types</h2>
<p>PdfDocumentParser provides the following options to operate with text and images:
<ul>
<li>Extracting text directly from PDF structure. This way is based on native text presentation inside PDF files. It is the main way to operate with text in PdfDocumentParser as it is the most robust and fast.</li>
<li>Getting text from image by OCR technology provided by Tesseract engine incorporated into PdfDocumentParser. This option must be chosen only when PDF processing does not work. It usually happens when documents you  want to parse consist completely or partially of images such as scanned documents, photos etc. This way cannot not give 100% accuracy against PDF processing and will acceptably work only for images with resolution not less than 300dpi. Also this way is much slower.</li>
<li>Image comparison. This way is used for seeking and comparing images in documents. It is usually used in document recognition marks but also can be used in floating anchors. This way is slower than PDF processing and so must be declined when possible. Also, it may not provide 100% accuracy on scanned documents if they have essential discrepancy in size, contrast, brightness, orientation etc.</li>
</ul>

<h2>Scanned documents</h2>
<p>Scanned documents are not the first subject for PdfDocumentParser but they are supported on a basic level. Usually such documents need to be preprocessed before feeding them to OCR engine. Such preprocessing includes auto-deskew, image rotation options. 
<p>Because of quality deviations in scanned documents the image comparison tolerance parameters may need to be tuned.
<p>The image resolution in PdfDocumentParser must be set to not less than 300dpi, otherwise OCR will not work. On the other hand, increasing resolution increases processing time. Also, setting resolution in PdfDocumentParser higher than the resolution of original images will not make sense. Image resolution parameter is common for all templates and can be changed in the settings window. 


<h2>Considerations</h2>
<p>When processing documents PdfDocumentParser applies every active template to every new document to recognize a proper template. So, if you have 50 templates and 1000 files evenly distributed for templates, PdfDocumentParser will do on average 1000/2 *50 = 25,000 template tries. It may take a considerable time especially with templates using OCR. You can decrease processing time by the following ways:
<ul> 
<li> specify file filters for templates. If it can be done then the tips below are not needed;
<li> always keep templates that do not correspond to files to be processed right now, inactive;
<li> put files which correspond to 1-10 templates only to a separate folder and make active only these templates and now process them. This way PdfDocumentParser will have to choose not among 50 templates but only 1-10 that will essentially decrease processing time. Do so for every batch of files;
</ul>
<p>A rule of thumb would be to process files which need OCR separately and keep their templates inactive when processing the rest files.

<h2>To be done</h2>
<p>While PDF mode just works as expected, OCR and Image modes due to their subjective nature have room for enhancement:
<ul> 
<li> Tesseract sometimes recognizes text for a page fragment better than for the whole page. Why is it? Need: switching to a newer Tesseract and probably Tesseract tuning and/or some effective image preprocessing;
<li> Image search and comparison implementation is basic. On the one hand, it is open to development, on the other hand, it may be better to switch to some advanced graphic processing package;
<br>
<br>
<br>
<br>

<div style=" margin-top:auto;    margin-bottom:auto;    text-align:center;
    align-content: center;
    display: flex;
    justify-content: center;    
    ">
        <script src="copyright.js"></script>
        &nbsp;©2018,&nbsp;&nbsp;<a href="mailto:sergey.stoyan@gmail.com?Subject=PdfDocumentParser request" target="_top">Sergey Stoyan</a>
</div>
</body>
</html>